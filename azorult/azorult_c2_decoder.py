
'''
:: sample: 966d45db3eeeca9124b235f9093aeab16d103f0a569323a16579ebeb3a6ee68c
'''
# azorult xor decoder
import binascii
import base64
import bitstring
import sys


def decode_url(ciphertext):
    key = binascii.unhexlify("09ff20")
    clear_text = ''
    for i in range(len(ciphertext)):
        clear_text += chr(ciphertext[i] ^ key[i % len(key)])
    print(base64.b64decode(clear_text))


src_file = sys.argv[1]
with open(src_file, 'rb') as fh:
    try:
        bitstring = bitstring.ConstBitStream(filename=src_file)
        c2_marker = '0x68b772399c'
        c2_start = bitstring.find(c2_marker, bytealigned=True)
        if c2_start:
            fh.seek(int(c2_start[0] / 8))
            encoded_c2 = (fh.read(44))
            decode_url(encoded_c2)
    except:
        print("bad file: {}".format(src_file))

rule netwire

{

meta:
  hash = "46e353d81fb7d21122eca30fd054d760"
  author = "pun1sh3r"


strings:

  $str1 = "NetWire" ascii wide nocase
  $str2 = "SOFTWARE\\NetWire" ascii wide nocase
  $str3 = "HostId" ascii wide nocase
  $str4 = "Install Date" ascii wide nocase
  $str5 = "@echo off" ascii wide nocase
  $str6 = "ping 192.0.2.2 -n 1 -w %d >nul 2>&1" ascii wide nocase
  $str7 = "DEL /s \"%s\" >nul 2>&1" ascii wide
  $str8 = "start /b \"\" cmd /c del \"%%~f0\"&exit /b" ascii wide
  $str9 = "User-Agent: Mozilla/4.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko" ascii wide nocase
  $str10 = "GET %s HTTP/1.1" ascii wide
  $str11 = "SeaMonkey" ascii wide nocase
  $str12 = "encryptedUsername" ascii wide nocase
  $str13 = "encryptedPassword" ascii wide nocase
  $str14 = "Profiles\\Outlook" ascii wide nocase
  $str15 = "Intelliforms\\storage2" ascii wide nocase

  $fmtstr = "%c%.8x%s"
  $fmtstr2 = "%s @ %s"
  $fmtstr3 = "%s:%u"
  $fmtstr4 = "%s:%d"
  $fmtstr5 = "%s\\%s.bat"
  $fmtstr6 = "[Log Started] - [%.2d/%.2d/%d %.2d:%.2d:%.2d]"
  $fmtstr7 = "[%s] - [%.2d/%.2d/%d %.2d:%.2d:%.2d]"
  $rc4_opcode = { C7 44 24 04 ?? ?? ?? ?? }
  $rc4_opcode2 = {88 44 06 08 83 c? 01  3d 00 01 00 00 75 ??  } //  cmp     eax, 100h
  $rc4_opcode3 =  { 83 c? 01 81 F? 00 01 00 00 75 ??}

condition:
  uint16(0) == 0x5a4d and  10  of ($str*) and 5 of ($fmtstr*) and all of ($rc4_opcode*)



}
